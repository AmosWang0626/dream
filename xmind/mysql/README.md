# MySQL

## MySQL 存储引擎

> MyISAM、InnoDB、Memory

#### MyISAM

不支持事务，不支持外键约束，索引文件和数据文件分开。内存中可以缓存更多的索引，对查询性能会更好，适用于那种少插入，多查询的场景。

经典案例：大数据场景下的报表系统。网站埋点日志、业务系统通过MySQL binlog同步业务数据，批量写入Hadoop后，在 T+1 进行离线批处理计算，
数据计算完，导入MySQL中，后边报表系统就可以直接从MySQL中查询已经计算好的数据，渲染成各种图，供他人使用。

但是在数据量非常多的情况下，几千万、几十亿数据时，MySQL是扛不住这么多数据的，一般建议单表500万以内数据量。

所以后来采用可配置化BI系统 + kylin + elastic search，支持大规模数据的复杂报表。

#### InnoDB

支持事务，强制要求主键，默认根据主键建立聚簇索引，支持外键约束。高并发（读写分离）、大数据量（分库分表）、高可用（主备切换）等相关成熟的数据库架构。

## 主键数据类型选型

推荐使用自增ID，那么如果自增ID用完了怎么办？

- int
    - 带符号 -21,4748,3648 ~ 21,4748,3647
    - 无符号 0 ~ 42,9496,7295（约42亿）

- bigint
    - 带符号 -922,3372,0368,5477,5808 ~ 922,3372,0368,5477,5807
    - 无符号 0 ~ 1844,6744,0737,0955,1615

1. 默认是int类型，自增ID最大值 4294967295，可以改为bigint类型
    - 怎么修改，直接Alter修改肯定需要停服，大概率是可以停服的
    - 如果不可以停服，主从切换，分别修改
2. 另外，单表数据量过亿，系统肯定早就应该重构了
    - 分库分表概括一下
    - 分库分表主键ID可采用雪花算法，或者其他分布式ID解决方案
